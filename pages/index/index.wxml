<!--pages/index/index.wxml-->
<view class="page-container">
  <!-- é¡¶éƒ¨ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-container">
    <view class="stats-card">
      <view class="stats-item">
        <view class="stats-number text-danger">{{expiredCount}}</view>
        <view class="stats-label">å·²è¿‡æœŸ</view>
      </view>
      <view class="stats-item">
        <view class="stats-number text-warning">{{warningCount}}</view>
        <view class="stats-label">å³å°†åˆ°æœŸ</view>
      </view>
      <view class="stats-item">
        <view class="stats-number text-success">{{normalCount}}</view>
        <view class="stats-label">æ­£å¸¸</view>
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿæ“ä½œåŒºåŸŸ -->
  <view class="quick-actions">
    <view class="action-item" bindtap="quickAddReminder">
      <view class="action-icon">ğŸ“</view>
      <view class="action-text">å¿«é€Ÿæ·»åŠ </view>
    </view>
    <view class="action-item" bindtap="scanCode">
      <view class="action-icon">ğŸ“·</view>
      <view class="action-text">æ‰«ç è¯†åˆ«</view>
    </view>
    <view class="action-item" bindtap="takePhoto">
      <view class="action-icon">ğŸ“¸</view>
      <view class="action-text">æ‹ç…§è¯†åˆ«</view>
    </view>
    <view class="action-item" bindtap="voiceInput">
      <view class="action-icon">ğŸ¤</view>
      <view class="action-text">è¯­éŸ³è¾“å…¥</view>
    </view>
  </view>

  <!-- ç­›é€‰å’Œæ’åº -->
  <view class="filter-bar">
    <view class="filter-left">
      <picker bindchange="onCategoryChange" value="{{categoryIndex}}" range="{{categories}}" range-key="name">
        <view class="filter-item">
          <text>{{categories[categoryIndex].name}}</text>
          <text class="filter-arrow">â–¼</text>
        </view>
      </picker>
      <picker bindchange="onSortChange" value="{{sortIndex}}" range="{{sortOptions}}">
        <view class="filter-item">
          <text>{{sortOptions[sortIndex]}}</text>
          <text class="filter-arrow">â–¼</text>
        </view>
      </picker>
    </view>
    <view class="filter-right">
      <view class="search-box">
        <input class="search-input" placeholder="æœç´¢æé†’..." value="{{searchKeyword}}" bindinput="onSearchInput" />
        <view class="search-icon">ğŸ”</view>
      </view>
    </view>
  </view>

  <!-- æé†’åˆ—è¡¨ -->
  <view class="reminder-list">
    <block wx:if="{{filteredReminders.length > 0}}">
      <view class="reminder-item {{item.status}}" wx:for="{{filteredReminders}}" wx:key="id" bindtap="viewDetail" data-id="{{item.id}}">
        <view class="reminder-left">
          <view class="reminder-icon" style="background-color: {{item.category.color}}">
            {{item.category.icon}}
          </view>
          <view class="reminder-content">
            <view class="reminder-title">{{item.title}}</view>
            <view class="reminder-desc">{{item.description}}</view>
            <view class="reminder-category">
              <text class="category-tag" style="background-color: {{item.category.color}}20; color: {{item.category.color}}">{{item.category.name}}</text>
            </view>
          </view>
        </view>
        <view class="reminder-right">
          <view class="reminder-date {{item.status}}">
            <view class="date-text">{{item.expireDateText}}</view>
            <view class="days-text">{{item.daysText}}</view>
          </view>
          <view class="reminder-actions">
            <view class="action-btn" bindtap="toggleComplete" data-id="{{item.id}}" catchtap="true">
              <text class="action-icon">{{item.isCompleted ? 'âœ…' : 'â­•'}}</text>
            </view>
            <view class="action-btn" bindtap="editReminder" data-id="{{item.id}}" catchtap="true">
              <text class="action-icon">âœï¸</text>
            </view>
          </view>
        </view>
      </view>
    </block>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:else>
      <view class="empty-icon">ğŸ“‹</view>
      <view class="empty-text">æš‚æ— æé†’äº‹é¡¹</view>
      <view class="empty-desc">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ æ‚¨çš„ç¬¬ä¸€ä¸ªæé†’</view>
      <button class="btn btn-primary btn-round" bindtap="navigateToAdd">ç«‹å³æ·»åŠ </button>
    </view>
  </view>

  <!-- æµ®åŠ¨æ·»åŠ æŒ‰é’® -->
  <view class="fab" bindtap="navigateToAdd">
    <text class="fab-icon">+</text>
  </view>

  <!-- æ™ºèƒ½å»ºè®®å¼¹çª— -->
  <view class="suggestion-modal {{showSuggestion ? 'show' : ''}}" bindtap="hideSuggestion">
    <view class="suggestion-content" catchtap="true">
      <view class="suggestion-header">
        <text class="suggestion-title">æ™ºèƒ½å»ºè®®</text>
        <text class="suggestion-close" bindtap="hideSuggestion">Ã—</text>
      </view>
      <view class="suggestion-body">
        <view class="suggestion-item" wx:for="{{suggestions}}" wx:key="index" bindtap="applySuggestion" data-suggestion="{{item}}">
          <view class="suggestion-icon">{{item.icon}}</view>
          <view class="suggestion-text">
            <view class="suggestion-name">{{item.name}}</view>
            <view class="suggestion-desc">{{item.description}}</view>
          </view>
          <view class="suggestion-arrow">â†’</view>
        </view>
      </view>
    </view>
  </view>
</view>