<!--pages/add/add.wxml-->
<view class="page-container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">{{isEdit ? 'ç¼–è¾‘æé†’' : 'æ·»åŠ æé†’'}}</text>
    <text class="page-subtitle">{{isEdit ? 'ä¿®æ”¹æ‚¨çš„æé†’ä¿¡æ¯' : 'åˆ›å»ºä¸€ä¸ªæ–°çš„æé†’äº‹é¡¹'}}</text>
  </view>

  <!-- æ™ºèƒ½è¾“å…¥åŒºåŸŸ -->
  <view class="smart-input-section" wx:if="{{!isEdit}}">
    <view class="section-title">
      <text class="title-icon">ğŸ¤–</text>
      <text class="title-text">æ™ºèƒ½è¾“å…¥</text>
    </view>
    
    <view class="input-methods">
      <view class="method-item" bindtap="scanCode">
        <view class="method-icon">ğŸ“·</view>
        <view class="method-text">æ‰«ç è¯†åˆ«</view>
      </view>
      <view class="method-item" bindtap="takePhoto">
        <view class="method-icon">ğŸ“¸</view>
        <view class="method-text">æ‹ç…§è¯†åˆ«</view>
      </view>
      <view class="method-item" bindtap="voiceInput">
        <view class="method-icon">ğŸ¤</view>
        <view class="method-text">è¯­éŸ³è¾“å…¥</view>
      </view>
      <view class="method-item" bindtap="showTemplates">
        <view class="method-icon">ğŸ“‹</view>
        <view class="method-text">å¿«é€Ÿæ¨¡æ¿</view>
      </view>
    </view>
  </view>

  <!-- åŸºæœ¬ä¿¡æ¯è¡¨å• -->
  <view class="form-section">
    <view class="section-title">
      <text class="title-icon">ğŸ“</text>
      <text class="title-text">åŸºæœ¬ä¿¡æ¯</text>
    </view>

    <!-- æé†’æ ‡é¢˜ -->
    <view class="form-group">
      <view class="form-label">
        <text class="label-text">æé†’æ ‡é¢˜</text>
        <text class="label-required">*</text>
      </view>
      <input class="form-input {{titleError ? 'error' : ''}}" 
             placeholder="è¯·è¾“å…¥æé†’æ ‡é¢˜" 
             value="{{formData.title}}" 
             bindinput="onTitleInput" 
             maxlength="50" />
      <view class="input-counter">{{formData.title.length}}/50</view>
      <view class="form-error" wx:if="{{titleError}}">{{titleError}}</view>
    </view>

    <!-- æé†’æè¿° -->
    <view class="form-group">
      <view class="form-label">
        <text class="label-text">è¯¦ç»†æè¿°</text>
      </view>
      <textarea class="form-textarea" 
                placeholder="è¯·è¾“å…¥è¯¦ç»†æè¿°ï¼ˆå¯é€‰ï¼‰" 
                value="{{formData.description}}" 
                bindinput="onDescriptionInput" 
                maxlength="200" 
                auto-height></textarea>
      <view class="input-counter">{{formData.description.length}}/200</view>
    </view>

    <!-- åˆ†ç±»é€‰æ‹© -->
    <view class="form-group">
      <view class="form-label">
        <text class="label-text">é€‰æ‹©åˆ†ç±»</text>
        <text class="label-required">*</text>
      </view>
      <view class="category-grid">
        <view class="category-item {{item.id === formData.categoryId ? 'active' : ''}}" 
              wx:for="{{categories}}" 
              wx:key="id" 
              bindtap="selectCategory" 
              data-id="{{item.id}}">
          <view class="category-icon" style="background-color: {{item.color}}">
            {{item.icon}}
          </view>
          <text class="category-name">{{item.name}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ—¶é—´è®¾ç½® -->
  <view class="form-section">
    <view class="section-title">
      <text class="title-icon">â°</text>
      <text class="title-text">æ—¶é—´è®¾ç½®</text>
    </view>

    <!-- åˆ°æœŸæ—¥æœŸ -->
    <view class="form-group">
      <view class="form-label">
        <text class="label-text">åˆ°æœŸæ—¥æœŸ</text>
        <text class="label-required">*</text>
      </view>
      <picker mode="date" 
              value="{{formData.expireDate}}" 
              start="{{today}}" 
              bindchange="onExpireDateChange">
        <view class="date-picker {{!formData.expireDate ? 'placeholder' : ''}}">
          <text class="date-text">{{formData.expireDate || 'è¯·é€‰æ‹©åˆ°æœŸæ—¥æœŸ'}}</text>
          <text class="date-icon">ğŸ“…</text>
        </view>
      </picker>
      <view class="form-error" wx:if="{{dateError}}">{{dateError}}</view>
    </view>

    <!-- æ™ºèƒ½æ—¥æœŸå»ºè®® -->
    <view class="date-suggestions" wx:if="{{dateSuggestions.length > 0}}">
      <view class="suggestions-title">ğŸ’¡ æ™ºèƒ½å»ºè®®</view>
      <view class="suggestions-list">
        <view class="suggestion-item" 
              wx:for="{{dateSuggestions}}" 
              wx:key="index" 
              bindtap="appleDateSuggestion" 
              data-date="{{item.date}}">
          <text class="suggestion-text">{{item.text}}</text>
          <text class="suggestion-desc">{{item.desc}}</text>
        </view>
      </view>
    </view>

    <!-- æé†’æ—¶é—´ -->
    <view class="form-group">
      <view class="form-label">
        <text class="label-text">æé†’æ—¶é—´</text>
      </view>
      <picker mode="time" 
              value="{{formData.remindTime}}" 
              bindchange="onRemindTimeChange">
        <view class="time-picker">
          <text class="time-text">{{formData.remindTime || '09:00'}}</text>
          <text class="time-icon">ğŸ•˜</text>
        </view>
      </picker>
    </view>

    <!-- æå‰æé†’å¤©æ•° -->
    <view class="form-group">
      <view class="form-label">
        <text class="label-text">æå‰æé†’</text>
      </view>
      <view class="remind-days-options">
        <view class="remind-option {{item === formData.remindDays ? 'active' : ''}}" 
              wx:for="{{remindDaysOptions}}" 
              wx:key="*this" 
              bindtap="selectRemindDays" 
              data-days="{{item}}">
          <text>{{item === 0 ? 'å½“å¤©' : item + 'å¤©å‰'}}</text>
        </view>
      </view>
      
      <!-- è‡ªå®šä¹‰å¤©æ•° -->
      <view class="custom-days" wx:if="{{showCustomDays}}">
        <input class="custom-input" 
               type="number" 
               placeholder="è‡ªå®šä¹‰å¤©æ•°" 
               value="{{customRemindDays}}" 
               bindinput="onCustomDaysInput" />
        <text class="custom-unit">å¤©å‰</text>
      </view>
      
      <view class="custom-toggle" bindtap="toggleCustomDays">
        <text>{{showCustomDays ? 'ä½¿ç”¨é¢„è®¾' : 'è‡ªå®šä¹‰å¤©æ•°'}}</text>
      </view>
    </view>
  </view>

  <!-- é«˜çº§è®¾ç½® -->
  <view class="form-section">
    <view class="section-title" bindtap="toggleAdvanced">
      <text class="title-icon">âš™ï¸</text>
      <text class="title-text">é«˜çº§è®¾ç½®</text>
      <text class="toggle-icon">{{showAdvanced ? 'â–¼' : 'â–¶'}}</text>
    </view>

    <view class="advanced-content" wx:if="{{showAdvanced}}">
      <!-- é‡å¤è®¾ç½® -->
      <view class="form-group">
        <view class="form-label">
          <text class="label-text">é‡å¤æé†’</text>
        </view>
        <picker bindchange="onRepeatChange" value="{{repeatIndex}}" range="{{repeatOptions}}">
          <view class="repeat-picker">
            <text>{{repeatOptions[repeatIndex]}}</text>
            <text class="picker-arrow">â–¼</text>
          </view>
        </picker>
      </view>

      <!-- ä¼˜å…ˆçº§è®¾ç½® -->
      <view class="form-group">
        <view class="form-label">
          <text class="label-text">ä¼˜å…ˆçº§</text>
        </view>
        <view class="priority-options">
          <view class="priority-item {{item.value === formData.priority ? 'active' : ''}}" 
                wx:for="{{priorityOptions}}" 
                wx:key="value" 
                bindtap="selectPriority" 
                data-priority="{{item.value}}">
            <text class="priority-icon">{{item.icon}}</text>
            <text class="priority-text">{{item.text}}</text>
          </view>
        </view>
      </view>

      <!-- æ ‡ç­¾è®¾ç½® -->
      <view class="form-group">
        <view class="form-label">
          <text class="label-text">æ ‡ç­¾</text>
        </view>
        <view class="tags-input">
          <view class="tag-item" wx:for="{{formData.tags}}" wx:key="*this">
            <text class="tag-text">{{item}}</text>
            <text class="tag-remove" bindtap="removeTag" data-index="{{index}}">Ã—</text>
          </view>
          <input class="tag-input" 
                 placeholder="æ·»åŠ æ ‡ç­¾" 
                 value="{{newTag}}" 
                 bindinput="onTagInput" 
                 bindconfirm="addTag" />
        </view>
      </view>

      <!-- é€šçŸ¥è®¾ç½® -->
      <view class="form-group">
        <view class="form-label">
          <text class="label-text">é€šçŸ¥æ–¹å¼</text>
        </view>
        <view class="notification-options">
          <view class="notification-item">
            <switch checked="{{formData.enableWechatNotify}}" 
                    bindchange="onWechatNotifyChange" />
            <text class="notification-text">å¾®ä¿¡é€šçŸ¥</text>
          </view>
          <view class="notification-item">
            <switch checked="{{formData.enableAppNotify}}" 
                    bindchange="onAppNotifyChange" />
            <text class="notification-text">åº”ç”¨å†…é€šçŸ¥</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button class="btn btn-secondary btn-large" bindtap="cancel">å–æ¶ˆ</button>
    <button class="btn btn-primary btn-large" 
            bindtap="save" 
            disabled="{{saving}}" 
            loading="{{saving}}">
      {{saving ? 'ä¿å­˜ä¸­...' : (isEdit ? 'æ›´æ–°' : 'ä¿å­˜')}}
    </button>
  </view>

  <!-- åˆ é™¤æŒ‰é’®ï¼ˆç¼–è¾‘æ¨¡å¼ï¼‰ -->
  <view class="delete-section" wx:if="{{isEdit}}">
    <button class="btn btn-danger btn-block" bindtap="deleteReminder">
      åˆ é™¤æ­¤æé†’
    </button>
  </view>
</view>

<!-- æ¨¡æ¿é€‰æ‹©å¼¹çª— -->
<view class="template-modal {{showTemplateModal ? 'show' : ''}}" bindtap="hideTemplateModal">
  <view class="template-content" catchtap="true">
    <view class="template-header">
      <text class="template-title">å¿«é€Ÿæ¨¡æ¿</text>
      <text class="template-close" bindtap="hideTemplateModal">Ã—</text>
    </view>
    <view class="template-body">
      <view class="template-category" wx:for="{{templateCategories}}" wx:key="name">
        <view class="template-category-title">{{item.name}}</view>
        <view class="template-list">
          <view class="template-item" 
                wx:for="{{item.templates}}" 
                wx:key="id" 
                wx:for-item="template"
                bindtap="applyTemplate" 
                data-template="{{template}}">
            <view class="template-icon">{{template.icon}}</view>
            <view class="template-info">
              <view class="template-name">{{template.name}}</view>
              <view class="template-desc">{{template.description}}</view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>